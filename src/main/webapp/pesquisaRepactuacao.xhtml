<ui:composition 

    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns="http://www.w3.org/1999/xhtml">

    <h:panelGroup id="repactuacaoPanelGroup">
        <h:panelGroup id="repactuacaoSubPanel">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <p:outputLabel value="Número do termo de apostilamento*"
                                       for="numeroTermoApostilamento" />
                        <p:inputText id="numeroTermoApostilamento"
                                     value="#{managerRepactuacao.repactuacao.numeroTermo}"
                                     placeholder="Número"
                                     rendered="true"
                                     requiredMessage="Este campo é obrigatório."
                                     styleClass="form-control" 
                                     />
                        <p:message for="numeroTermoApostilamento" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group" style="display: flex;flex-direction: column" >
                        <p:outputLabel value="Valor"
                                       for="novoValorRepactuacao" />
                        <p:inputNumber id="novoValorRepactuacao"   value="#{managerRepactuacao.repactuacao.valor}" symbol="R$"
                                       symbolPosition="p" emptyValue="always" requiredMessage="Este campo é obrigatório." style="width: 100%"/>
                        <p:message for="novoValorRepactuacao" />
                    </div>
                </div>
                <div class="col-md-3">
                    <p:outputLabel value="Data de assinatura"
                                   for="dataAssinaturaRepactuacao" />
                    <p:calendar id="dataAssinaturaRepactuacao"
                                rendered="true"
                                value="#{managerRepactuacao.repactuacao.dataAssinatura}"
                                mask="true"
                                style="display: flex; flex-direction: row"
                                disabled="#{managerRepactuacao.visualizar}"
                                requiredMessage="Este campo é obrigatório."
                                inputStyleClass="form-control"
                                showOn="button"
                                />
                    <p:message for="dataAssinaturaRepactuacao" />
                </div>
            </div>
        </h:panelGroup>
        <center>
            <p:commandButton value="Pesquisar" icon="pi pi-search" process="@this repactuacaoSubPanel" update="repactuacaoDatatable corpoInteiro:messages" actionListener="#{managerRepactuacao.pesquisar(managerContrato.contrato)}" />
        </center>
        <hr/>
        <p:dataTable id="repactuacaoDatatable" var="repactuacao" value="#{managerRepactuacao.repactuacoes}"
                     resizeMode="5">
            <f:facet name="header">
                <center>
                    Histórico de Repactuação
                </center>
            </f:facet>
            <p:column headerText="Ações" width="200">
                <p:commandButton  icon="pi pi-trash" 
                                  process="@this"
                                  oncomplete="PF('removeraRepactuacaoConfirmDialog').show();" title="exluir" >
                    <f:setPropertyActionListener value="#{repactuacao}"
                                                 target="#{managerRepactuacao.repactuacao}"/>
                </p:commandButton>
                <p:button  icon="pi pi-eye" title="visualizar" href="repactuacao.xhtml?visualizar=#{repactuacao.id}" />
            </p:column>

            <p:column headerText="N° do Termo de Apostilamento" width="300px">
                <h:outputText value="#{repactuacao.numeroTermo}" />
            </p:column>
            <p:column headerText="Valor alterado">
                <h:outputText value="#{managerRepactuacao.boString(repactuacao.valorMudou)}"  />
            </p:column>
            <p:column headerText="Valor">
                <h:outputText value="#{repactuacao.valor}" />
            </p:column>
            <p:column headerText="Fiscal responsável">
                <h:outputText value="#{repactuacao.fiscal.nome}" />
            </p:column>
            <p:column headerText="Data de firmação">
                <h:outputText value="#{managerRepactuacao.dataFormatada(repactuacao.dataAssinatura)}"  />
            </p:column>
            <p:column headerText="Justificativa">
                <h:outputText value="#{repactuacao.descricao}"  />
            </p:column>
        </p:dataTable>
    </h:panelGroup>
    <p:dialog id="removeraRepactuacaoConfirmDialog"
              widgetVar="removeraRepactuacaoConfirmDialog"
              header="Atenção!"
              closeOnEscape="true"
              draggable="false"
              maximizable="false"
              minimizable="false"
              modal="true"
              width="850"
              showEffect="fade"
              hideEffect="fade">

        <div class="row">

            <div class="col-md-12">
                <div class="form-group" style="padding-left: 80px !important">
                    <h4>
                        <i class="pi pi-exclamation-triangle"></i>
                        Tem certeza de que deseja remover esta Repactuacao ?
                    </h4>
                </div>
            </div>

            <div class="col-md-12">

                <center>

                    <p:commandButton value="Sim"
                                     title="Confirmar Remoção"
                                     icon="pi pi-check"
                                     update="@this repactuacaoDatatable"
                                     process="@this"
                                     actionListener="#{managerRepactuacao.deletar()}"
                                     oncomplete="PF('removeraRepactuacaoConfirmDialog').hide();"
                                     styleClass="mr-md-1"/>

                    <p:commandButton value="Não"
                                     title="Cancelar Remoção"
                                     icon="pi pi-ban"
                                     process="@this"
                                     update="@form"
                                     oncomplete="PF('removeraRepactuacaoConfirmDialog').hide();"
                                     styleClass="ml-md-1"/>

                </center>

            </div>

        </div>


    </p:dialog>

</ui:composition>
