<ui:composition 
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns="http://www.w3.org/1999/xhtml">

    <h:panelGroup id="renovacaoPanelGroup">

        <h:panelGroup id="renovacaoSubPanel">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <p:outputLabel value="Contrato*" styleClass="control-label" for="contratoRenovacao" />
                        <p:selectOneMenu id="contratoRenovacao"
                                         value="#{managerRenovacao.renovacao.contrato}"
                                         filter="true" 
                                         placeholder="Contrato"
                                         disabled="#{managerRenovacao.visualizar}"
                                         styleClass="form-control" 
                                         converter="contratoconverter">
                            <f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
                            <f:selectItems value="#{managerRenovacao.contratos}" var="contrato" itemLabel="#{contrato.numeroContrato}" itemValue="#{contrato}" />
                        </p:selectOneMenu>
                    </div>
                </div>
            </div>
        </h:panelGroup>
        <center>
            <p:commandButton value="Pesquisar" icon="pi pi-search" process="@this renovacaoSubPanel" update="renovacaoDatatable" actionListener="#{managerRenovacao.pesquisar()}" />
        </center>
        <hr/>
        <p:dataTable id="renovacaoDatatable" var="renovacao" value="#{managerRenovacao.renovacoes}"
                     resizeMode="5">
            <f:facet name="header">
                <center>
                    Histórico de renovação
                </center>
            </f:facet>
            <p:column headerText="Ações" width="200">
                <p:commandButton  icon="pi pi-trash" 
                                  process="@this"

                                  oncomplete="PF('removeraRenovacaoConfirmDialog').show();" title="exluir" >
                    <f:setPropertyActionListener value="#{renovacao}"
                                                 target="#{managerRenovacao.renovacao}"/>
                </p:commandButton>
                <p:button  icon="pi pi-eye" title="visualizar" href="#{managerRenovacao.urlVisualizar(renovacao.id)}" />
            </p:column>
            <p:column headerText="N° do Termo Aditivo">
                <h:outputText value="#{renovacao.numeroTermo}" />
            </p:column>
            <p:column headerText="Valor foi alterado">
                <h:outputText value="#{renovacao.valorMudou}"  />
            </p:column>
            <p:column headerText="Valor" width="100px">
                <h:outputText value="#{renovacao.valor}" />
            </p:column>
            <p:column headerText="Fiscal responsável">
                <h:outputText value="#{renovacao.fiscal.nome}" />
            </p:column>
            <p:column headerText="Data de firmação">
                <h:outputText value="#{renovacao.dataAssinatura}"  />
            </p:column>
            <p:column headerText="Nova vigência">
                <h:outputText value="#{renovacao.dataFinal}"  />
            </p:column>
            <p:column headerText="Vigência anterior">
                <h:outputText value="#{renovacao.vigenciaAnterior}"  />
            </p:column>
            <p:column headerText="Próxima renovação">
                <h:outputText value="#{renovacao.proximaRenovacao}"  />
            </p:column>
        </p:dataTable>
        <p:dialog id="removeraRenovacaoConfirmDialog"
                  widgetVar="removeraRenovacaoConfirmDialog"
                  header="Atenção!"
                  closeOnEscape="true"
                  draggable="false"
                  maximizable="false"
                  minimizable="false"
                  modal="true"
                  width="850"
                  showEffect="fade"
                  hideEffect="fade">

            <div class="row">

                <div class="col-md-12">
                    <div class="form-group" style="padding-left: 80px !important">
                        <h4>
                            <i class="pi pi-exclamation-triangle"></i>
                            Tem certeza de que deseja remover esta Renovacao ?
                        </h4>
                    </div>
                </div>

                <div class="col-md-12">

                    <center>

                        <p:commandButton value="Sim"
                                         title="Confirmar Remoção"
                                         icon="pi pi-check"
                                         update="@this renovacaoDatatable"
                                         process="@this"
                                         actionListener="#{managerRenovacao.deletar()}"
                                         oncomplete="PF('removeraRenovacaoConfirmDialog').hide();"
                                         styleClass="mr-md-1"/>

                        <p:commandButton value="Não"
                                         title="Cancelar Remoção"
                                         icon="pi pi-ban"
                                         process="@this"
                                         update="@form"
                                         oncomplete="PF('removeraRenovacaoConfirmDialog').hide();"
                                         styleClass="ml-md-1"/>

                    </center>

                </div>

            </div>


        </p:dialog>
    </h:panelGroup>

</ui:composition>
